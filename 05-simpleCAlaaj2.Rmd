#  Yhteisvaikutusmuuttujat

Yksinkertaisin tapa tutkia taustamuuttujien yhteisvaikuksia on yhdistää kaksi
muuttujaa uudeksi luokitelumuuttujaksi (“interactive coding”). Miehet ja naiset
on luokiteltu kuuteen ikäluokkaan (1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65,
6= 66 tai vanhempi). 

Poikkileikkausaineistossa vastaajan ikä kertoo myös ikäluokan (kohortin).
Vastaajat ovat kokeneet  kaksi suurta mullistusten vuotta elämänsä eri vaiheissa.
Kaksin nuorinta ikäluokka on ollut 1990 alle 14-vuotiaita ja vanhin ikäluokka
yli 44-vuotiaita. Finannsikriisin vuonna 2008 toiseksi nuorin ikäluokka on ollut
22-31 vuotiaita, ja kaksi vanhinta yli 51-vuotiaita. Pelkän ikävaikutuksen
analyysi edellyttäisi vähintään kahden aineiston yhdistämistä.

Jatkan esimerkkiä kolmen muuttujan yhteisvaikutusmuuttjalla, jossa oteaan mukaan
myös maa. Käytännössä kolmen luokittelumuuttujan yhdistäminen tekee taulukosta
jo hieman huteron, joissain soluissa havaintojen määrä pienenee. Tässä kaikissa
soluissa on sentää viisi havaintoa tai enemmän. Pienten massojen ja harvinaisten
luokkien vaikutukset on kuitenkin arvioitava, ne voivat joskus mutta onneksi
harvoin määrittää sitä liikaa.

## Ikä ja sukupuoli

```{r CAlaaj2-4agecat, echo=FALSE}
# Iän ja sukupuolen vuorovaikutusmuuttujia
#
# Uusi R-data: ISSP2012esim1b.dat2esim1b)
#
# Ikäluokat age_cat
# AGE 1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 and older
#
# summary(ISSP2012esim1.dat$AGE)
# hist(ISSP2012esim1.dat$ika)

ISSP2012esim1b.dat <- mutate(ISSP2012esim1.dat,
                      age_cat = ifelse(ika %in% 15:25, "1",
                        ifelse(ika %in% 26:35, "2",
                        ifelse(ika %in% 36:45, "3",
                        ifelse(ika %in% 46:55, "4",
                        ifelse(ika %in% 56:65, "5", "6"))))))


ISSP2012esim1b.dat <- ISSP2012esim1b.dat %>%  
        mutate(age_cat = as_factor(age_cat)) # järjestys omituinen!(4.2.20)

# Tarkistuksia
# str(ISSP2012esim2.dat$age_cat)
# levels(ISSP2012esim2.dat$age_cat)
# ISSP2012esim2.dat$age_cat %>% summary()

# Järjestetään ikäluokat uudelleen

ISSP2012esim1b.dat <- ISSP2012esim1b.dat %>%
        mutate(age_cat =
                fct_relevel(age_cat,
                            "1",
                            "2",
                            "3",
                            "4",
                            "5",
                            "6")
               )

# Tarkistuksia

# Iso taulukko, voi tarkistaa että muunnos ok.
# test6 %>% tableX(AGE, age_cat, type = "count")
# taulu42 <- ISSP2012esim2.dat %>% tableX(maa,age_cat,type = "count")
# kable(taulu42,digits = 2, caption = "Ikäluokka age_cat")
#

# Taulukoita (4.2.20)

#ISSP2012esim1b.dat %>%
#    tableX(maa,age_cat,type = "count") %>%
#    kable(digits = 2, caption = "Ikäluokka age_cat")
#
#ISSP2012esim1b.dat %>%
#    tableX(maa,age_cat,type = "row_perc") %>%
#    kable(digits = 2, caption = "age_cat: suhteelliset frekvenssit")

```

Ikäjäkauma painottuu kaikissa maissa jonkinverran vanhempiin ikäluokkiin.
Nuorempien ikäluokkien osuus on (alle 26-vuotiaat ja alle 26-35 - vuotiaat)
varsinkin Bulgariassa (BG) ja Unkarissa (HU) pieni.

Ikäluokilla on luonnolinen järjestys, niiden pisteet voi yhdistää nuorimmasta
vanhimpaan.

```{r CAlaaj2-ga, echo=FALSE}
# ga - ikäluokka ja sukupuoli

ISSP2012esim1b.dat <- mutate(ISSP2012esim1b.dat,
                        ga = case_when((age_cat == "1")&(sp == "m") ~ "m1",
                                       (age_cat == "2")&(sp == "m") ~ "m2",
                                       (age_cat == "3")&(sp == "m") ~ "m3",
                                       (age_cat == "4")&(sp == "m") ~ "m4",
                                       (age_cat == "5")&(sp == "m") ~ "m5",
                                       (age_cat == "6")&(sp == "m") ~ "m6",
                                       (age_cat == "1")&(sp == "f") ~ "f1",
                                       (age_cat == "2")&(sp == "f") ~ "f2",
                                       (age_cat == "3")&(sp == "f") ~ "f3",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "5")&(sp == "f") ~ "f5",
                                       (age_cat == "6")&(sp == "f") ~ "f6",
                                       TRUE ~ "missing"
                                  ))

#ISSP2012esim1.dat %>% tableX(ga,ga2) # tarkistus
# muuttujien tarkistuksia 19.9.2018
# str(ISSP2012esim1b.dat$ga) # chr-muuttuja, mutta toimii (4.2.20)

#Tulostetaan taulukkoina ga - muuttuja

#ISSP2012esim1b.dat %>% tableX(maa,ga,type = "count") %>%
#kable(digits = 2, caption = "Ikäluokka ja sukupuoli ga")

#ISSP2012esim1b.dat %>% tableX(maa,ga,type = "row_perc") %>%
#kable(digits = 2, caption = "ga: suhteelliset frekvenssit")

```


```{r gaCA1, echo=FALSE}

gaTestCA1 <- ca(~ga + Q1b,ISSP2012esim1b.dat)

```

```{r gaCA1map,echo=FALSE  ,fig.cap = "Q1b: ikäluokka ja sukupuoli",fig.asp = 1, out.width = "90%",fig.align = "center"}

# Maapisteiden pääkoordinaatit janojen piirtämiseen

gaTestCA1.rpc <- gaTestCA1$rowcoord %*% diag(gaTestCA1$sv)

# par(cex = 0.6)
plot(gaTestCA1, main = "symmetrinen kartta, m = mies, f = nainen",
     sub = "1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 tai vanhempi ")
# naiset
lines(gaTestCA1.rpc[1:6,1],gaTestCA1.rpc[1:6,2])
#miehet
lines(gaTestCA1.rpc[7:12,1],gaTestCA1.rpc[7:12,2], col = "red")


```

Ratkaisu on melko yksiulotteinen, ensimmäinen dimensio kuvaa 87 prosenttia
kokonaisinertiasta. Dimenioiden tulkinta on suurinpiirtein sama kuin kuin
edellisissä kartoissa, mutta S-sarake on kiusallisesti s-sarakkeen vasemmalla
puolella. Numeerisista tuloksista näkee, että sarakkeiden s ja E osuus
kokonaisinertiasta (sarake inr) on 768. Niiden kontribuutio x-akselille on
yhteensä vielä suurempi (849). Muut sarakkeet taas kontribuoivat y-akselin
inertiaan, mutta sen osuus kokonaisinertiasta on vain 9 prosenttia. Kun sarakkeet
kuitenkin ovat aika hyvin esitettyjä (qlt), voidaan x- akseli tulkinta hieman
karkeammin samaa mieltä - eri mieltä - tasolla samaksi liberaalien ja
konservatiivisten asenteiden ulottuvuudeksi. Toinen dimensio kuvaa tiukempaa
samanmielisyyttä (S), kontrastina neutraali (?) ja maltillinen erimielisyys (s).

```{r ikaspnumres1, echo=FALSE}

summary(gaTestCA1)

```

Rivien massat ovat yllättävän saman kokoisia, mutta kolmen ryhmän (f2, f6 ja m6)
osuus kokonaisinertiasta on 616 ja niiden kontribuutio ensimmäiselle dimensiolle
on 567. Vain 36-45-vuotiaiden miesten (m3) piste on huonosti esitetty (qlt = 457).
Tulkinta on hankalaa miesten ja naisten nuorimman ryhmän osalta, vaikka efekti
kartalla on iso. Molempien osuus kokonaisinertiasta on pieni (inr). Nuoret naiset
(f1) on kuvattu kartalla erittäin hyvin.  Nuorten miesten (m1) esityksen laatu
on heikompi, ja kaikista suurin kontribuutio on vain y-akselille. Kun muut
ikäryhmät (paitsi f3) ovat ikäjärjestyksessä vasemmalta oikealle, voi nuorimpien
ja vanhimpien ikäryhmien sijainnin tulkita osittain toisen dimension (varma
mielipide - epävarma mielipide) avulla.

Selvästi kaikissa ikäluokissa miehet ovat konservatiimisempia kuin naiset.
Nuorin ikäluokka on hieman vähemmän varma mielipiteistään kuin vanhin.
Yksi mahdollinen selitys kartan tulkinnan ongelmille on se, että maiden väliset
erot mielipiteissä ovat paljon suurempia kuin sukupuolten väliset maiden sisällä
(ISSP 1994 aineisto, CAiP, s.126).


## Ikä, sukupuoli ja maa



```{r maaga1}
ISSP2012esim1b.dat <- mutate(ISSP2012esim1b.dat,
                             maaga = paste(maa, ga, sep = ""))

# tarkistus, muunnos ok
# ISSP2012esim1b.dat %>% tableX(maa, maaga)
# head(ISSP2012esim2.dat)
# str(ISSP2012esim2.dat)

```



```{r maagaCAeka, echo=FALSE}

maagaCA1 <- ca(~maaga + Q1b,ISSP2012esim1b.dat)

```

```{r maagaCA1map1,echo=FALSE, fig.cap = "Q1b: ikäluokka ja sukupuoli maittain",fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.5)
plot(maagaCA1, main = "symmetrinen kartta 1",
                sub = "cex=0.5")

```

Kuvasta saa jotenkin selvää, kun sen suurentaa mutta pisteitä on selvästi liikaa.
Joitain muuttujien nimiä voisi lyhentää, kuva-alaa voisi rajata joihinkin osiin
mutta osajoukon korrespondenssianalyysi tarjoaa pätevimmän vaihtoehdon.


Sarakkeiden järjestys vasemmalta oikealle ja ylhäältä alas on sama kuin edellisissä
kartoissa. Dimenisoiden tulkinta on sama, osuus inertiasta pienenee x-akselilla
noin 6 prosenttiyksikköä. Pisteiden järjestys liberaalista konservatiiviseen
alkaa Tanskan ja Suomen pisteistä, sitten tulee Saksan ja Belgian pisteitä ja
konservatiisimpia ovat oikeassa laidassa Unkarin ja Bulgarian osajoukot. Toisella
akselilla maltillisia ja neutraaleja ovat hyvin karkeasti Suomen pisteet ja lähes
kaikki Saksan ja Belgian pisteet. Eri maiden osajoukkojen suhteita on hankalampi
hahmottaa, erityisesti kartan oikealla laidalla.


```{r maagaCA1num, eval = TRUE, echo = TRUE}

# Vilkaistaan numeerisia tuloksia, kopioidaan tekstiin jos on tarpeellista

# print(maagaCA1)

summary(maagaCA1)

```

Sarakkeet on kohtailaisen hyvin esitetty, heikoimmin neutraali vaihtoehto (535).
Kun sen suhteellinen kontribuutio (cor) on vain 1 toisella dimensiolla jää
loppuosa x-akselille. Maltillisuuden dimensiota määrittää e-sarakke (ctr = 646),
ja vain sitä. Ensimmäistä dimensiota määrittää vahvimmin E-sarake (ctr = 645)
liberaaliin ja samaa mieltä olevien sarakkeet (s, S) konsertatiiviseen suuntaan.


Kun aineistossa on 72 riviä on inertian suhteellisen kontribuution keskiarvo
noin 14. Tämän ylittäviä kontribuutiota on Bulgaria naisilla (BGf2, BGf3, BGf5
ja BGf6) kaikilla konservatiiviseen suuntaan. Sama pätee Unkarin naisille, muuten 
naisten ikäluokat kontribuoivat yleensä liberaaliin suuntaan. Suomen pisteiden
absoluuttiset kontribuutiot lähes pelkästään toiselle dimenisolle maltilliseen
suuntaan. Tanska taas kontribui vahvahsti jyrkempien mielipiteiden suuntaan.

Kaikissa taulukon soluissa on vähintään viisi havaintoa, muutama pienen massan
havainto kontribuoi kohtuullisen paljon. Kuvan laadun takia ryhmiä pitäisi
yhdistellä.

## Stabiilisuus

Tarkastelen tässä vain ratkaisustabiiliutta (solution stability). Siinä data on
annettu, ja ratkaisun numeerisista tuloksista nähdään miten pisteet määritättävät
akselit. Ulkoinen stabiilius on laajempi käsite, mikä on datan suhde esimerkiksi
johonkin perusjoukkoon (CAiP, s. 225). Ratkaisu on stabiili niiden pisteiden
suhteen jotka eivät vaikuta siihen.

Korrespondenssianalyysiä ja erityisesti khii2- etäisyysmittaa on arvosteltu siitä,
että se on liian herkkä harvinaisille luokittelumuuttujan arvoille.
Yhteenvetoartikkelissan MG (Loose ends) tarttuu ”vaikuttavien poikkeavien
havaintojen myyttiin”, ja pitää sitä lähes aina perusteettomana.

Harvinaiset kategoriat ovat usein kartalla kaukana origosta, mutta jokaisella
pisteellä on massa ja näillä ”outlayereilla” se on pieni. Niinpä niiden
vaikutuskin on vaatimaton.

Harvinaisten kategorioiden vaikututus voi olla suuri, joten numeerisista
tuloksita on tarkistettava onko hyvin pienen massan pisteillä suuri kontribuutio
ratkaisuun. Käytännössä näin voi käydä esimerkiksi silloin, kun jonkun
harvinaisen luokittelumuuttujan arvon havainnot ovat keskittyneet muutamaan
profiiliin joissa niiden osuus on suuri (CAiP, s 298). Luvussa 7 nähdään, miten
melko vähäinen määrä puuttuvia vastuaksia kasaantuu samaan vastaajien osajoukkoon
ja mitä seurauksia sillä on.

Stabiiliutta voi helposti kokeilla määrittelemällä joitain pisteitä täydentäviksi
pisteiksi.

Edellisen kartan numeerisista tuloksista ei löydy pienen massan pisteitä joilla
on merkittävä kontribuutio akseleihin.
