#  Yhteisvaikutusmuuttujat

Yksinkertaisin tapa tutkia taustamuuttujien yhteisvaikutuksia on yhdistää kaksi
muuttujaa uudeksi luokittelumuuttujaksi (“interactive coding”). Miehet ja naiset
on seuraavaksi luokiteltu kuuteen ikäluokkaan (1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65,
6= 66 tai vanhempi). 

Poikkileikkausaineistossa vastaajan ikä kertoo myös ikäluokan (kohortin).
Vastaajat ovat kokeneet kaksi suurta mullistusten vuotta elämänsä eri vaiheissa.
Kaksi nuorinta ikäluokkaa on ollut 1990 alle 14-vuotiaita ja vanhin ikäluokka
yli 44-vuotiaita. Finanssikriisin vuonna 2008 toiseksi nuorin ikäluokka on ollut
22-31 vuotiaita, ja kaksi vanhinta yli 51-vuotiaita. Pelkän ikävaikutuksen
analyysi edellyttäisi vähintään kahden aineiston yhdistämistä.

Kolmen muuttujan yhteisvaikutusmuuttajaan yhdistän vastaajan maan.
myös maa. Käytännössä kolmen luokittelumuuttujan yhdistäminen tekee taulukosta
jo huteron, joissain soluissa havaintojen määrä pienenee. Kaikissa
soluissa on sentään viisi havaintoa tai enemmän. Pienten massojen profiilien ja harvinaisten
kategorioiden vaikutukset on kuitenkin arvioitava, ne voivat joskus, mutta onneksi
harvoin, määrittää sitä liikaa.

## Ikä ja sukupuoli

```{r CAlaaj2-4agecat, echo=FALSE}
# Iän ja sukupuolen vuorovaikutusmuuttujia
#
# Uusi R-data: ISSP2012esim1b.dat2esim1b)
#
# Ikäluokat age_cat
# AGE 1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 and older
#
# summary(ISSP2012esim1.dat$AGE)
# hist(ISSP2012esim1.dat$ika)

ISSP2012esim1b.dat <- mutate(ISSP2012esim1.dat,
                      age_cat = ifelse(ika %in% 15:25, "1",
                        ifelse(ika %in% 26:35, "2",
                        ifelse(ika %in% 36:45, "3",
                        ifelse(ika %in% 46:55, "4",
                        ifelse(ika %in% 56:65, "5", "6"))))))


ISSP2012esim1b.dat <- ISSP2012esim1b.dat %>%  
        mutate(age_cat = as_factor(age_cat)) # järjestys omituinen!(4.2.20)

# Tarkistuksia
# str(ISSP2012esim2.dat$age_cat)
# levels(ISSP2012esim2.dat$age_cat)
# ISSP2012esim2.dat$age_cat %>% summary()

# Järjestetään ikäluokat uudelleen

ISSP2012esim1b.dat <- ISSP2012esim1b.dat %>%
        mutate(age_cat =
                fct_relevel(age_cat,
                            "1",
                            "2",
                            "3",
                            "4",
                            "5",
                            "6")
               )

# Tarkistuksia

# Iso taulukko, voi tarkistaa että muunnos ok.
# test6 %>% tableX(AGE, age_cat, type = "count")
# taulu42 <- ISSP2012esim2.dat %>% tableX(maa,age_cat,type = "count")
# kable(taulu42,digits = 2, caption = "Ikäluokka age_cat")
#

# Taulukoita (4.2.20)

#ISSP2012esim1b.dat %>%
#    tableX(maa,age_cat,type = "count") %>%
#    kable(digits = 2, caption = "Ikäluokka age_cat")
#
#ISSP2012esim1b.dat %>%
#    tableX(maa,age_cat,type = "row_perc") %>%
#    kable(digits = 2, caption = "age_cat: suhteelliset frekvenssit")

```

Ikäjakauma painottuu kaikissa maissa jonkin verran vanhempiin ikäluokkiin.
Nuorempien ikäluokkien osuus on (alle 26-vuotiaat ja alle 26-35 - vuotiaat)
varsinkin Bulgariassa (BG) ja Unkarissa (HU) pieni.

Ikäluokilla on luonnollinen järjestys, niiden pisteet voidaan yhdistää nuorimmasta
vanhimpaan.

```{r CAlaaj2-ga, echo=FALSE}
# ga - ikäluokka ja sukupuoli

ISSP2012esim1b.dat <- mutate(ISSP2012esim1b.dat,
                        ga = case_when((age_cat == "1")&(sp == "m") ~ "m1",
                                       (age_cat == "2")&(sp == "m") ~ "m2",
                                       (age_cat == "3")&(sp == "m") ~ "m3",
                                       (age_cat == "4")&(sp == "m") ~ "m4",
                                       (age_cat == "5")&(sp == "m") ~ "m5",
                                       (age_cat == "6")&(sp == "m") ~ "m6",
                                       (age_cat == "1")&(sp == "f") ~ "f1",
                                       (age_cat == "2")&(sp == "f") ~ "f2",
                                       (age_cat == "3")&(sp == "f") ~ "f3",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "4")&(sp == "f") ~ "f4",
                                       (age_cat == "5")&(sp == "f") ~ "f5",
                                       (age_cat == "6")&(sp == "f") ~ "f6",
                                       TRUE ~ "missing"
                                  ))

#ISSP2012esim1.dat %>% tableX(ga,ga2) # tarkistus
# muuttujien tarkistuksia 19.9.2018
# str(ISSP2012esim1b.dat$ga) # chr-muuttuja, mutta toimii (4.2.20)

#Tulostetaan taulukkoina ga - muuttuja

#ISSP2012esim1b.dat %>% tableX(maa,ga,type = "count") %>%
#kable(digits = 2, caption = "Ikäluokka ja sukupuoli ga")

#ISSP2012esim1b.dat %>% tableX(maa,ga,type = "row_perc") %>%
#kable(digits = 2, caption = "ga: suhteelliset frekvenssit")

```


```{r gaCA1, echo=FALSE}

gaTestCA1 <- ca(~ga + Q1b,ISSP2012esim1b.dat)

```

```{r gaCA1map,echo=FALSE  ,fig.cap = "Q1b: ikäluokka ja sukupuoli",fig.asp = 1, out.width = "90%",fig.align = "center"}

# Maapisteiden pääkoordinaatit janojen piirtämiseen

gaTestCA1.rpc <- gaTestCA1$rowcoord %*% diag(gaTestCA1$sv)

# par(cex = 0.6)
plot(gaTestCA1, main = "symmetrinen kartta, m = mies, f = nainen",
     sub = "1=15-25, 2 =26-35, 3=36-45, 4=46-55, 5=56-65, 6= 66 tai vanhempi ")
# naiset
lines(gaTestCA1.rpc[1:6,1],gaTestCA1.rpc[1:6,2])
#miehet
lines(gaTestCA1.rpc[7:12,1],gaTestCA1.rpc[7:12,2], col = "red")


```

Ratkaisu on melko yksiulotteinen, ensimmäinen dimensio kuvaa 87 prosenttia
kokonaisinertiasta. Dimensioiden tulkinta on suurin piirtein sama kuin 
edellisissä kartoissa, mutta S-sarake on kiusallisesti s-sarakkeen vasemmalla
puolella. Numeerisista tuloksista näkee (ks. tuloste alla), että sarakkeiden s ja E osuus
kokonaisinertiasta (sarake inr) on 768. Niiden kontribuutio x-akselille on
yhteensä vielä suurempi (849). Muut sarakkeet taas kontribuoivat y-akselin
inertiaan, mutta sen osuus kokonaisinertiasta on vain 9 prosenttia. Kun sarakkeet
kuitenkin ovat aika hyvin esitettyjä (qlt), voidaan x- akseli tulkinta hieman
karkeammin samaa mieltä - eri mieltä - tasolla samaksi liberaalien ja
konservatiivisten asenteiden ulottuvuudeksi. Toinen dimensio kuvaa tiukempaa
samanmielisyyttä (S), kontrastina neutraali (?) ja maltillinen erimielisyys (s).


```{r ikaspnumres1, echo=FALSE}

summary(gaTestCA1)

```

Rivien massat ovat melko samankokoisia, mutta kolmen ryhmän (f2, f6 ja m6)
osuus kokonaisinertiasta on 616 ja niiden kontribuutio ensimmäiselle dimensiolle
on 567. Vain 36-45-vuotiaiden miesten (m3) piste on huonosti esitetty (qlt = 457).
Tulkinta on hankalaa miesten ja naisten nuorimman ryhmän osalta, vaikka efekti
kartalla on iso. Molempien osuus kokonaisinertiasta on pieni (inr). Nuoret naiset
(f1) on kuvattu kartalla erittäin hyvin.  Nuorten miesten (m1) esityksen laatu
on heikompi, ja kaikista suurin kontribuutio on vain y-akselille. Kun muut
ikäryhmät (paitsi f3) ovat ikäjärjestyksessä vasemmalta oikealle, voi nuorimpien
ja vanhimpien ikäryhmien sijainnin tulkita osittain toisen dimension (varma
mielipide - epävarma mielipide) avulla.

Selvästi kaikissa ikäluokissa miehet ovat konservatiivisempia kuin naiset.
Nuorin ikäluokka on vähemmän varma mielipiteistään kuin vanhin.
Yksi mahdollinen selitys kartan tulkinnan ongelmille on se, että maiden väliset
erot mielipiteissä ovat paljon suurempia kuin sukupuolten väliset maiden sisällä
(ISSP 1994 aineisto, CAiP, s.126).


## Ikä, sukupuoli ja maa

Ikäluokan, sukupuolen ja maan yhteisvaikutusmuuttuja lisää kuvapisteiden
määrää. Kuvasta \@ref(fig:maagaCA1map1) saa jotenkin selvää, kun sen suurentaa mutta pisteitä on selvästi
liikaa. Joitain muuttujien nimiä voisi lyhentää, kuva-alaa voisi rajata joihinkin
osiin mutta osajoukon korrespondenssianalyysi tarjoaa pätevimmän vaihtoehdon.


```{r maaga1, echo=FALSE}
ISSP2012esim1b.dat <- mutate(ISSP2012esim1b.dat,
                             maaga = paste(maa, ga, sep = ""))

# tarkistus, muunnos ok
# ISSP2012esim1b.dat %>% tableX(maa, maaga)
# head(ISSP2012esim2.dat)
# str(ISSP2012esim2.dat)

```



```{r maagaCAeka, echo=FALSE}

maagaCA1 <- ca(~maaga + Q1b,ISSP2012esim1b.dat)

```

```{r maagaCA1map1,echo=FALSE, fig.cap = "Q1b: ikäluokka ja sukupuoli maittain",fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.5)
plot(maagaCA1, main = "symmetrinen kartta 1" )

```


Sarakkeiden järjestys vasemmalta oikealle ja ylhäältä alas on sama kuin edellisissä
kartoissa. Dimensioiden tulkinta on sama, osuus inertiasta pienenee x-akselilla
noin 6 prosenttiyksikköä. Pisteiden järjestys liberaalista konservatiiviseen
alkaa Tanskan ja Suomen pisteistä, sitten tulevat Saksan ja Belgian pisteet ja
konservatiivisimpia ovat oikeassa laidassa Unkari ja Bulgaria. Toisella
akselilla maltillisia ja neutraaleja ovat karkeasti Suomen pisteet ja lähes
kaikki Saksan ja Belgian pisteet. Eri maiden osajoukkojen suhteita on hankalampi
hahmottaa, erityisesti kartan oikealla laidalla.

Numeeristen tulosten taulukko on pitkä (ks. alle), mutta kartan informaatio pitää varmistaa.
Numeeriset tulokset eivät ole pelkkää diagnostiikkaa ja kartan esittämien
riippuvuuksien varmistamista. Niistä näkee myös tarkemmin mahdolliset kiinnostavat
piirteet datassa. Regressiomallien tulosten raporteissa diagnostiikka on usein
liitteenä, mutta eksploratiivisessa data-analyysissä se ohjaa analyysiä eteenpäin.

Tässä voi nähdä myös todennäköisyysteoriaan perustuvan tilastollisen mallintamisen
vahvan puolen, aineiston rakenne ja muuttujien yhteydet saadaan parhaassa
tapauksessa esitettyä paljon tiiviimmin.


```{r maagaCA1num, eval = TRUE, echo = FALSE}

# print(maagaCA1)

summary(maagaCA1)

```

Tuloksista nähdään, että sarakkeet on kohtalaisen hyvin esitetty, heikoimmin
neutraali vaihtoehto (qlt = 535).
Kun sen suhteellinen kontribuutio (cor) on vain 1 toisella dimensiolla jää
loppuosa x-akselille. Maltillisuuden dimensiota määrittää e-sarake (ctr = 646),
ja vain sitä. Ensimmäistä dimensiota määrittää vahvimmin E-sarake (ctr = 645)
liberaaliin ja samaa mieltä olevien sarakkeet (s, S) konservatiiviseen suuntaan.


Kun aineistossa on 72 riviä, on inertian suhteellisen kontribuution keskiarvo
noin 14. Tämän ylittäviä kontribuutiota on Bulgarian naisilla (BGf2, BGf3, BGf5
ja BGf6), kaikilla konservatiiviseen suuntaan. Sama pätee Unkarin naisille, muuten 
naisten ikäluokat kontribuoivat yleensä liberaaliin suuntaan. Suomen pisteiden
absoluuttiset kontribuutiot ovat lähes pelkästään toiselle dimensiolle maltilliseen
suuntaan. Tanska taas kontribuoi vahvasti jyrkempien mielipiteiden suuntaan.


## Stabiilisuus

Tarkastelen tässä vain ratkaisustabiiliutta (solution stability). Siinä data on
annettu, ja ratkaisun numeerisista tuloksista nähdään miten pisteet määrittävät
akselit.  Ratkaisu on stabiili niiden pisteiden suhteen, jotka eivät vaikuta
siihen.

Ulkoinen stabiilius on laajempi käsite, siinä huomioidaan esimerkiksi
datan suhde johonkin perusjoukkoon (CAiP, s. 225).

Korrespondenssianalyysiä ja erityisesti khii2- etäisyysmittaa on arvosteltu siitä,
että se on liian herkkä harvinaisille luokittelumuuttujan arvoille.
Yhteenvetoartikkelissaan @RefWorks:doc:5c768b09e4b02df9431e950a tarttuu ”vaikuttavien
poikkeavien havaintojen myyttiin”, ja pitää sitä lähes aina perusteettomana.

Harvinaiset kategoriat ovat usein kartalla kaukana origosta, mutta jokaisella
pisteellä on massa ja näillä poikkeavilla havainnoilla (outlier) se on pieni. Niinpä niiden
vaikutuskin on vaatimaton.

Harvinaisten kategorioiden vaikutus voi olla suuri, joten numeerisista
tuloksista on tarkistettava, onko hyvin pienen massan pisteillä suuri kontribuutio
ratkaisuun. Käytännössä näin voi käydä esimerkiksi silloin, kun jonkun
harvinaisen luokittelumuuttujan arvon havainnot ovat keskittyneet muutamaan
profiiliin, joissa niiden osuus on suuri (CAiP, s 298). Luvussa 7 nähdään, miten
melko vähäinen määrä puuttuvia vastauksia kasaantuu samaan vastaajien osajoukkoon
ja mitä seurauksia sillä on.

Stabiiliutta voi helposti kokeilla määrittelemällä joitain pisteitä täydentäviksi
pisteiksi. 

En löytänyt kartan \@ref(fig:maagaCA1map1) numeerisista tuloksista pienen massan
pisteitä, joilla on merkittävä kontribuutio akseleihin.
