# Osajoukon korrespondenssianalyysi

Graafisessa data-analyysissä kuvien on oltava selkeitä, mutta
korrespondenssianalyysin ja monimuutujakorrespondenssianalyysin kartat ovat usein
liian täynnä pisteitä. Ongelmaa voi lievenätää jättämällä pois ratkaisuun vain
vähän vaikutttavia pisteitä, keksimällä mahdollisimman lyhyitä symboleja
muuttujille tai rajaamalla kuvaa. Ongelma on kuitenkin syvempi, usein kartta
kertoo aika yllätyksettömän ja ilmeisen tarinan. Kiinnostavammat yhteydet
pysyvät piilossa ylemmissä dimensioissa.  MCA-kartan perusongelma on se, että
siinä yritetään esittää monia erityyppisiä yhteyksiä simultaanisesti ja nämä
yhteydet eivät ole “isolated to particular dimensions”
( @RefWorks:doc:5a857a44e4b0ed2d44664d87 , 198).


Osajoukon korrespondenssianalyysi (subset CA, MCA) on yksi vastaus tähän
pulmaan. Teoreettiset perusteet on esitetty Greenacren ja Pardon artikkelissa
[@RefWorks:doc:5a857a44e4b0ed2d44664d87] ja sen laajennetussa versiossa (emt.),
esimerkkiaineistona ISSP:n 1994 data. Selkeä oppikirjaesitys on CAiP (ss. 161-). 


Eräs selkeä sovelluskohde yhteiskuntatieteellisissä kyselyaineistoissa on
puuttuvien vastausten analyysi, johon palataan seuraavassa luvussa.

Osajoukon korrespondenssianlyysin idea on säilyttää koko aineiston massat ja
khii2-etäisyyksien painot mutta analysoida vain osaa aineistosta. Koko aineiston
sentroidi säilyy kartan keksipisteenä. Osajoukkojen inertioiden summa on koko
aineiston inertia.

Osajoukon voi valita havaintojen tai muuttujien suhteen. Täydentäviä pisteitä
voi helposti lisätä kartalle , jos ne eivät kuulu siihen joukkoon josta
osajoukko on valittu.  Osajoukon profiilit muuttuvat, niiden summa ei enään ole
yksi ja barysentristä periaatetta ei voi suoraan käyttää täydentävän pisteen
koordinaattien laskemiseen. Tässä esimerkissä emme voi suoraan ca-paketin avulla
sijoittaa esimerkiksi maapisteitä kartoille.

Karttaa \@ref(fig:maagaCA1map1) katsomalla on helppo jakaa aineisto aluksi vain kahteen ryhmään.
Suomi, Tanska ja Saksa ovat pääakselin oikealla puolella.
Bulgaria ja Unkari yhdessä Belgian kanssa ovat toinen ryhmä.



```{r maagaSubDKDEFI, echo=F}

# Osajoukon CA: Tanska, Saksa ja Suomi
maagaCA2sub2 <- ca(~maaga + Q1b,ISSP2012esim1b.dat,subsetrow = 25:60)

```



```{r maagaCA2sub2map1, echo=F, eval = T, fig.cap= "Ikä, sukupuoli ja maa:Tanska-Saksa-Suomi", fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.8)
plot(maagaCA2sub2, main = "Q1b: Lapsi kärsii jos äiti käy töissä",
     sub = "symmetrinen kartta - Tanska, Saksa ja Suomi (subset ca)"
   )

```

**k** Kontribuutiokartan tulkinta

**k** Akseleiden tulkinta: 1. dimensio on kontrasti vahvasti eri mieltä olevien
ja kaikkien muiden vastausten välillä. Toinen dimensio kontrasti e-vastauksen 
ja kaikkien muiden vastausten kanssa, erityiesti S, s, ja myös neutraali ?.

**k** Ei tulkintaa sarakkeiden etäisyyksille, mutta kontribuutiolle on.

```{r maagaCA2sub2map3,echo=F, fig.cap= "Ikä, sukupuoli ja maa:Tanska-Saksa-Suomi", fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.6)
plot(maagaCA2sub2, map = "rowgreen",
     mass = c(TRUE, TRUE),
     contrib =c("relative", "absolute"),
     arrows = c(FALSE, TRUE),
     main = "Kontribuutiokartta: sarakkeiden(abs.) ja rivien(rel.) värisävy",
     sub = "massat pisteiden kokoina, cex=0.06"
      )

```

Karttoja \@ref(fig:maagaCA2sub2map1) ja \@ref(fig:maagaCA2sub2map3) joutuu katsomaan
aika tarkkaan ennnekkuin uskoo, että akseleiden skaalaus on akateeminen pulmma
vailla käytännön merkitystä (kts. jakso 3.3.4). Dataa analysoidaan graafisesti, ja kuvat
_näyttävät_ erilaisilta. Pääakselien inertioiden neliöjuuret ovat `r round(sqrt(0.10709),3)` ja `r round(sqrt(0.02498),3)`,
sarakkeet voisi siis tulkita myös kontribuutiokuvista.


```{r maagaCA2sub2map2,echo=F, fig.cap= "Ikä, sukupuoli ja maa:Tanska-Saksa-Suomi", fig.asp = 1, out.width = "90%",fig.align = "center"}
# ca-tulosobjekti maagaCA2sub2, DK DE FI

maagaLinesDKDEFI <- cacoord(maagaCA2sub2, type = "symmetric")
maagaLinesDKDEFI <- maagaLinesDKDEFI$rows[ , 1:2]
# maagaLinesDKDEFI # tarkistus
par(cex = 0.6)
plot(maagaCA2sub2,
     sub = "symmetrinen kartta - Tanska, Saksa ja Suomi (subset ca)")
lines(maagaLinesDKDEFI[1:6,1],maagaLinesDKDEFI[1:6,2], col="blue") #DEf
lines(maagaLinesDKDEFI[7:12,1],maagaLinesDKDEFI[7:12,2], col="red")  #DEm
lines(maagaLinesDKDEFI[13:18,1],maagaLinesDKDEFI[13:18,2], col="blue") #DKf
lines(maagaLinesDKDEFI[19:24,1],maagaLinesDKDEFI[19:24,2], col="red")  #DKm
lines(maagaLinesDKDEFI[25:30,1],maagaLinesDKDEFI[25:30,2], col="blue") #FIf
lines(maagaLinesDKDEFI[31:36,1],maagaLinesDKDEFI[31:36,2], col="red")  #FIm

```

**k** Rivipisteiden tulkinta


```{r maagaCA2sub2num1, echo=F}

# Tarkastetaan numeeriset tulokset
summary(maagaCA2sub2)

# Jos suhteeelinen inertia kaikilla rivelillä sama
# 1000/36 = 28

```

**Tulkintaa**

Kolmen maan osajoukon ratkaisussa 2. dimensiolla (maltillinen liberaali?) on
inertiasta 17 prosenttia, edellä ollut paljon yksiulotteisempia ratkaisuja. Huono kvaliteetti
on DEf1 (467) ja DEf6 (48!), DEm4 (285). Tanskan havainnoista vanhimmat miehet
(DKm6,291) ovat kaikkein huonoimmin esitettyjä ratkaisussa, ja hieman nuoremmatkin
(DKm5, 682). Suomen aineistossa vain nuoret miehet (FIm1, 624) on esitetty kartalla
huonosti. Kaksi dimensiot selittävät osajoukon kokonaishajonnasta 92%, mutta muutaman
ryhmän hajonta on muissa dimensioissa. Saksan naisten iäkkäin ikäluokka (DEf6)
ja keski-ikäisen miehet (DEm4) vain näyttävät olevan lähekkäin origon tuntumassa,
samoin muutama muu huonosti tasoon sijoitettu piste.

Huonosti kuvatuista pisteistä ei kuva ei siis kerro oikeastaan mitään muuta.

Sarakkeet on esitetty kohtalaisen hyvin, ja symmetrisessä kartassa tärkeimmälle
dimensioille projisodut sarakepisteet ovat odotetussa järjestyksessä.

Kontribuutiokartasta nähdään, että tärkein kontrasti on tiukan erimielisyyden (E)
ja kaikkien muiden vastausvaihtoehtojen välillä. Epävarmojen tai maltillisten (e)
kontrasti hallitsee toista dimensiota, erityisesti S- ja s- kategorioiden kanssa.
Samalla kuvasta näkee (ja numeerisist tuloksista voi vahvistaa), että S-piste on
on lähempänä (kulma on pienempi) pystyakselia. Kontribuutio on suurempi (147 vs.
71 x-akselille). Toisaalta x-akseli selittää selvästi suurimman osan kaikkien muiden
sarakepisteiden inertiasta, ja y-akseli taas lähes täysin e-pisteen inertian.

```{r maagaBEBGHU, echo=F}

# Belgia, Bulgaria ja Unkari analysoidaan tiiviisti
# Belgia on vähän välitapaus Bulgarian ja Unkarin ja kolmen ensimmäisen maan
# kanssa. Kokeiluja voi tehdä neljällä maaryhmällä, kuvan lukukelpoisuus
# ratkaisee.

#BGHUsubset <- c(13:24,61:72)
#BEDEDKFIsubset <- c(1:12, 25:36, 37:48, 49:60)
#DEDKFIsubset <- c(25:36, 37:48, 49:60)

BEBGHUsubset <- c(1:12,13:24,61:72)
maagaCA2sub3 <- ca(~maaga + Q1b,ISSP2012esim1b.dat,subsetrow = BEBGHUsubset)

```


Kontribuutiokartalla ei voi tulkita sarakkeiden etäisyyksiä, joten ensin symmmetrinen kartta.

```{r  maagaCA2sub3map1,echo=F, fig.cap= "Ikä, sukupuoli ja maa: Belgia-Bulgaria - Unkari 1", fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.6)
plot(maagaCA2sub3, 
     mass = c(TRUE, TRUE),
     contrib =c("relative", "absolute"),
     arrows = c(FALSE, FALSE),
     main = "symmetrinen kartta: sarakkeiden ja rivien suhteelliset kontribuutiot värisävynä ",
     sub = "massat pisteiden kokoina, cex=0.06"
      )

```

Ensimmäisen dimension tulkinta pysyy samana, mutta nyt molemmat erimieliset
(E, e) vastauskategoriat ovat selvästi oikealla. Ne ovat lähes x-akselin päällä,
kun ensimmäisen osajoukon kartalla e-sarake oli oikealla ja alhaalla kontrastina
S- ja s- vastauksille ja myös neutraalille vaihtoehdolle. Kartan toinen dimenisio
erottelee nyt tiukasti ja lievemmin samaa mieltä olevat, neutraali vaihtoehto
jää väliin. 

Belgian nuoremmat ikäluokat ovat liberaalilla puolella, ja kiinnostavasti
kaksi vanhinta miesten ryhmää on pystysuunnassa kaikkein maltillisimpia.
Bulgarian ja Unkarin pisteen ovat x-akselilla tiukasti konservatiivisa.
Vaihtelua on maltillisemman ja jyrkemmän konservatiivisuuden välillä
pystysuuntaan. Toisen dimension kontrasti on myös hieman yllättäen 
Bulgarian nuorimpien naisten (BGf1) Unkarin vanhimpiten naisten (HUf6)
välillä.

Kuvan \@ref(fig:maagaCA2sub2map2) tapaan ei Bulgarian ja Unkarin
ikäluokkia kannata yhdistää. Järjestys toki löytyy, mutta ei ollenkaan
niin selkeä. Saksan naisten ikäluokkakuva alkaa erkaantua hieman Suomen ja Taskan
hyvin samanalaisista kuvioista. Saksan miehillä on jo eroja paljon toisen
dimension suuntaan, Unkarin ja Bulgarian osajoukkojen erot ovat lähes
pelkästään pystysuoria.

Suhteellinen kontribuutio eli pisteen laatu (numeerisissa
tuloksissa "cor") on esitetty värisävynä. Sarakkeista e ja "?" on
esitetty huonosti, riveistä Belgian nuorimmat miehet ja naiset.




```{r  maagaCA2sub3map2,echo=F, fig.cap= "Ikä, sukupuoli ja maa: Belgia-Bulgaria - Unkari 2", fig.asp = 1, out.width = "90%",fig.align = "center"}

par(cex = 0.6)
plot(maagaCA2sub3, map = "rowgreen",
     mass = c(TRUE, TRUE),
     contrib =c("relative", "absolute"),
     arrows = c(FALSE, TRUE),
     main = "Kontribuutiokartta: sarakkeiden(abs.) ja rivien(abs.) värisävy",
     sub = "massat pisteiden kokoina, cex=0.06"
      )

```

Kontribuutiokartta \ref(fig:maagaCA2sub3map2) eroaa kartasta \ref(fig:maagaCA2sub2map3)
kolmen akselin (E, S ja s) tasapainosemmalla vaikutuksella ratkaisuun. Konservatiiviset
sarakepisteet ovat vaikuttavampia kuin E, maltillinen liberaali (s) ja neutraali vaihtoehto
vaikuttavat vähemmän.

**k** Yksityiskohdat ovat kiinnostavia, mutta graafisen analyysin
päätavoite on yleiskuva. Tässä ekspolratiivinen data-analyysi
kuitenkin kulkee hieman eri polkuja kuin tavaniomainen tilastollisten
mallien analyysi. Seuratataan minne data kuljettaa, etstiään uusia
näkökulmia. Iän ja sukupuolen yhteys vastauksiin on rakenteeltaan erilainen,
se ei ole ongelma vaan datan ominaisuus.

```{r maagaCA2sub3num1, echo = F}

# Vilkaistaa numeerisia tuloksia, kopioidaan tekstiin jos on tarpeen
# maagaCA2sub3
 summary(maagaCA2sub3)

# kahden osaratkaisun kokonaisinertia

# 0.143551 + 0.119602 = 0.263153
# koko datalla 0.263154

```


Kahden osajoukon inertioiden  summa on sama kuin koko aineiston
( `r round(0.143551,3)` + `r round(0.119602,3)` =  `r round((0.143551 + 0.119602),3)`),  Selitysasteet
nousevat hieman, mutta vielä oleellisempaa on kahden aika erilaisen ryhmän
havaitseminen.

Belgian jotkun pisteet: huono kvaliteetti (BEf1, BEf5,BEm1, BEm2). Bulgaria ja
Unkari hyvin esitetty. Belgia on pulmallinen tapaus, ehkä taas omissa dimensioissaan.

